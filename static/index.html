<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ancient Greek Language Trainer</title>
    
    <!-- CSS Stylesheets -->
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/animations.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/screens.css">
    <link rel="stylesheet" href="/static/css/modals.css">
    <link rel="stylesheet" href="/static/css/keyboard.css">
</head>
<body>
    <!-- Language Switcher -->
    <div class="language-switcher">
        <label for="languageMode">Language:</label>
        <select id="languageMode" onchange="switchLanguageMode()">
            <option value="greek">üèõÔ∏è Ancient Greek</option>
            <option value="latin">üèüÔ∏è Latin</option>
        </select>
    </div>

    <div class="container">
        <h1 id="appTitle">üèõÔ∏è Ancient Greek Trainer</h1>
        <p class="subtitle">Test your vocabulary knowledge</p>

        <!-- Setup Screen -->
        <div class="setup-screen active" id="setupScreen">
            <div class="form-group">
                <label for="sessionMode">Session Mode:</label>
                <select id="sessionMode">
                    <option value="training">Training + Exam</option>
                    <option value="exam">Exam Only</option>
                </select>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Training: Learn the words first, then get tested on them
                </small>
            </div>

            <div class="form-group">
                <label for="direction">Quiz Direction:</label>
                <select id="direction" onchange="updateProgressDisplay()">
                    <!-- Options will be populated based on language mode -->
                    <option value="greek_to_bulgarian">Ancient Greek ‚Üí Bulgarian</option>
                    <option value="bulgarian_to_greek">Bulgarian ‚Üí Ancient Greek</option>
                </select>
            </div>

            <div class="form-group" id="lessonsGroup">
                <label>Select Lessons:</label>
                <button type="button" class="select-lessons-btn" onclick="openLessonsModal()">
                    üìö Choose Lessons
                </button>
                <div class="selected-lessons-summary" id="selectedLessonsSummary">
                    Selected: <strong id="selectedLessonsText">All lessons</strong><br>
                    Available words: <strong id="availableWordsCount">0</strong>
                </div>
            </div>

            <!-- Progress Summary (shown for both Greek and Latin) -->
            <div class="progress-summary" id="progressSummary" style="margin-top: 10px; padding: 10px; background: #e8f5e9; border-radius: 5px; display: none;">
                <div style="font-weight: bold; margin-bottom: 5px;">üìä Your Progress:</div>
                <div id="progressStats" style="font-size: 0.9em;"></div>
            </div>

            <div class="form-group">
                <div class="checkbox-container">
                    <input type="checkbox" id="useAllWords" onchange="toggleWordCount()">
                    <label for="useAllWords" id="useAllWordsLabel">Use all available words</label>
                </div>
            </div>

            <div class="form-group">
                <div class="checkbox-container">
                    <input type="checkbox" id="randomOrder" checked>
                    <label for="randomOrder">Random order</label>
                </div>
            </div>

            <div class="form-group" id="wordCountGroup">
                <label for="wordCount">Number of Words:</label>
                <input type="number" id="wordCount" min="1" max="200" value="15">
            </div>

            <div class="form-group">
                <label for="timePerQuestion">Time per Question (seconds):</label>
                <input type="number" id="timePerQuestion" min="10" max="300" value="60" step="5">
                <small style="color: #666; display: block; margin-top: 5px;">
                    Default: 60 seconds (Range: 10-300 seconds)
                </small>
            </div>

            <button class="btn" onclick="startSession()">Start Session</button>
        </div>

        <!-- Training Screen -->
        <div class="training-screen" id="trainingScreen">
            <div class="progress-bar">
                <div class="progress-fill" id="trainingProgressFill"></div>
            </div>

            <div class="question-counter" id="trainingCounter"></div>

            <h2 style="text-align: center; color: #667eea; margin-bottom: 30px;">üìö Training Mode</h2>

            <div class="question-box" style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);">
                <div class="question-label" id="trainingPromptLabel"></div>
                <div class="question-text" id="trainingPrompt" style="color: #667eea;"></div>
                
                <div style="margin: 30px 0; padding: 20px; background: white; border-radius: 8px; border: 2px solid #667eea;">
                    <div style="font-size: 14px; color: #888; margin-bottom: 5px;">Translation:</div>
                    <div id="trainingAnswer" style="font-size: 28px; font-weight: 600; color: #333;"></div>
                </div>
            </div>

            <button class="btn" id="trainingNextBtn" onclick="nextTrainingWord()">Next Word</button>
            <button class="btn btn-secondary" onclick="skipToExam()">Skip to Exam</button>
        </div>

        <!-- Quiz Screen -->
        <div class="quiz-screen" id="quizScreen">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="question-counter" id="questionCounter"></div>

            <!-- Timer Display -->
            <div class="timer-container" id="timerContainer">
                <div class="timer-label">Time Remaining:</div>
                <div class="timer-display" id="timerDisplay">60</div>
            </div>

            <div class="question-box">
                <div class="question-label" id="questionLabel"></div>
                <div class="question-text" id="questionText"></div>
            </div>

            <div class="feedback hidden" id="feedback"></div>

            <div class="form-group">
                <div class="autocomplete-container">
                    <input type="text" id="answerInput" placeholder="Type your answer..." autocomplete="off">
                    <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
                </div>
                <button class="keyboard-toggle" id="keyboardToggle" onclick="toggleGreekKeyboard()">
                    ‚å®Ô∏è Show Greek Keyboard
                </button>
                <button class="keyboard-toggle" id="autocompleteToggle" onclick="toggleAutocomplete()" style="display: none;">
                    üí° Enable Autocomplete
                </button>
            </div>

            <!-- Greek Virtual Keyboard -->
            <div class="greek-keyboard-container" id="greekKeyboard">
                <div class="keyboard-section">
                    <div class="keyboard-section-title">Diacritics (Click to Toggle)</div>
                    <div class="keyboard-row">
                        <button class="diacritic-btn" data-diacritic="smoothBreathing" onclick="toggleDiacritic('smoothBreathing')" title="Smooth Breathing">·æø</button>
                        <button class="diacritic-btn" data-diacritic="roughBreathing" onclick="toggleDiacritic('roughBreathing')" title="Rough Breathing">·øæ</button>
                        <button class="diacritic-btn" data-diacritic="acute" onclick="toggleDiacritic('acute')" title="Acute Accent">¬¥</button>
                        <button class="diacritic-btn" data-diacritic="grave" onclick="toggleDiacritic('grave')" title="Grave Accent">`</button>
                        <button class="diacritic-btn" data-diacritic="circumflex" onclick="toggleDiacritic('circumflex')" title="Circumflex">·øÄ</button>
                        <button class="diacritic-btn" data-diacritic="iotaSubscript" onclick="toggleDiacritic('iotaSubscript')" title="Iota Subscript">ÕÖ</button>
                        <button class="diacritic-btn" data-diacritic="diaeresis" onclick="toggleDiacritic('diaeresis')" title="Diaeresis (œä, œã)">¬®</button>
                    </div>
                </div>

                <div class="keyboard-section">
                    <div class="keyboard-section-title">Vowels (Click after selecting diacritics)</div>
                    <div class="keyboard-row">
                        <button class="greek-key vowel-key" data-vowel="Œ±" onclick="insertVowelWithDiacritics('Œ±')">Œ±</button>
                        <button class="greek-key vowel-key" data-vowel="Œµ" onclick="insertVowelWithDiacritics('Œµ')">Œµ</button>
                        <button class="greek-key vowel-key" data-vowel="Œ∑" onclick="insertVowelWithDiacritics('Œ∑')">Œ∑</button>
                        <button class="greek-key vowel-key" data-vowel="Œπ" onclick="insertVowelWithDiacritics('Œπ')">Œπ</button>
                        <button class="greek-key vowel-key" data-vowel="Œø" onclick="insertVowelWithDiacritics('Œø')">Œø</button>
                        <button class="greek-key vowel-key" data-vowel="œÖ" onclick="insertVowelWithDiacritics('œÖ')">œÖ</button>
                        <button class="greek-key vowel-key" data-vowel="œâ" onclick="insertVowelWithDiacritics('œâ')">œâ</button>
                    </div>
                </div>

                <div class="keyboard-section">
                    <div class="keyboard-section-title">Consonants</div>
                    <div class="keyboard-row">
                        <button class="greek-key" data-lower="Œ≤" data-upper="Œí" onclick="insertGreekLetter('Œ≤', 'Œí')">Œ≤</button>
                        <button class="greek-key" data-lower="Œ≥" data-upper="Œì" onclick="insertGreekLetter('Œ≥', 'Œì')">Œ≥</button>
                        <button class="greek-key" data-lower="Œ¥" data-upper="Œî" onclick="insertGreekLetter('Œ¥', 'Œî')">Œ¥</button>
                        <button class="greek-key" data-lower="Œ∂" data-upper="Œñ" onclick="insertGreekLetter('Œ∂', 'Œñ')">Œ∂</button>
                        <button class="greek-key" data-lower="Œ∏" data-upper="Œò" onclick="insertGreekLetter('Œ∏', 'Œò')">Œ∏</button>
                        <button class="greek-key" data-lower="Œ∫" data-upper="Œö" onclick="insertGreekLetter('Œ∫', 'Œö')">Œ∫</button>
                        <button class="greek-key" data-lower="Œª" data-upper="Œõ" onclick="insertGreekLetter('Œª', 'Œõ')">Œª</button>
                        <button class="greek-key" data-lower="Œº" data-upper="Œú" onclick="insertGreekLetter('Œº', 'Œú')">Œº</button>
                        <button class="greek-key" data-lower="ŒΩ" data-upper="Œù" onclick="insertGreekLetter('ŒΩ', 'Œù')">ŒΩ</button>
                        <button class="greek-key" data-lower="Œæ" data-upper="Œû" onclick="insertGreekLetter('Œæ', 'Œû')">Œæ</button>
                        <button class="greek-key" data-lower="œÄ" data-upper="Œ†" onclick="insertGreekLetter('œÄ', 'Œ†')">œÄ</button>
                        <button class="greek-key vowel-key" data-vowel="œÅ" onclick="insertVowelWithDiacritics('œÅ')">œÅ</button>
                        <button class="greek-key" data-lower="œÉ" data-upper="Œ£" onclick="insertGreekLetter('œÉ', 'Œ£')">œÉ</button>
                        <button class="greek-key" onclick="insertGreek('œÇ')">œÇ</button>
                        <button class="greek-key" data-lower="œÑ" data-upper="Œ§" onclick="insertGreekLetter('œÑ', 'Œ§')">œÑ</button>
                        <button class="greek-key" data-lower="œÜ" data-upper="Œ¶" onclick="insertGreekLetter('œÜ', 'Œ¶')">œÜ</button>
                        <button class="greek-key" data-lower="œá" data-upper="Œß" onclick="insertGreekLetter('œá', 'Œß')">œá</button>
                        <button class="greek-key" data-lower="œà" data-upper="Œ®" onclick="insertGreekLetter('œà', 'Œ®')">œà</button>
                        <button class="greek-key" data-lower="œ°" data-upper="œ†" onclick="insertGreekLetter('œ°', 'œ†')">œ°</button>
                    </div>
                </div>

                <div class="keyboard-section">
                    <div class="keyboard-section-title">Tools</div>
                    <div class="keyboard-row">
                        <button class="greek-key shift-key" id="shiftBtn" onclick="toggleShift()">‚¨Ü Shift</button>
                        <button class="greek-key" onclick="insertGreek(', ')">comma</button>
                        <button class="greek-key" onclick="insertGreek('-')">-</button>
                        <button class="greek-key" onclick="insertGreek(' ')">space</button>
                        <button class="greek-key" onclick="resetDiacritics()">üîÑ Reset Diacritics</button>
                    </div>
                </div>
            </div>

            <!-- Diacritic Popup (appears when clicking on input text) -->
            <div class="diacritic-popup" id="diacriticPopup">
                <div class="diacritic-popup-title">Select variant:</div>
                <div class="diacritic-options" id="diacriticOptions"></div>
            </div>

            <button class="btn" id="submitBtn" onclick="submitAnswer()">Submit Answer</button>
        </div>

        <!-- Summary Screen -->
        <div class="summary-screen" id="summaryScreen">
            <h2 style="text-align: center; margin-bottom: 30px; color: #667eea;">Quiz Complete! üéâ</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="scorePercentage"></div>
                    <div class="stat-label">Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="correctCount"></div>
                    <div class="stat-label">Correct Answers</div>
                </div>
            </div>

            <div class="incorrect-list" id="incorrectList"></div>

            <div id="retakeSection" style="display: none;">
                <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #ffc107;">
                    <p style="margin: 0; color: #856404; font-weight: 600;">
                        üí° Want to improve your score? Retake the test with the same words!
                    </p>
                </div>
                <button class="btn" onclick="retakeExam()" style="background: #ffc107; margin-bottom: 10px;">
                    üîÑ Retake Exam (Same Words)
                </button>
            </div>

            <button class="btn" onclick="restartQuiz()">Start New Quiz</button>
        </div>
    </div>

    <!-- Lessons Selection Modal -->
    <div class="modal" id="lessonsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìö Select Lessons</h2>
                <button class="modal-close" onclick="closeLessonsModal()">&times;</button>
            </div>
            
            <div class="lessons-controls">
                <button type="button" onclick="selectAllLessons()">Select All</button>
                <button type="button" onclick="deselectAllLessons()">Deselect All</button>
            </div>
            
            <div class="lessons-picker" id="lessonsSelector">
                <!-- Lessons will be loaded dynamically -->
            </div>
            
            <div class="selected-lessons-summary" style="margin-top: 15px; margin-bottom: 15px;">
                <strong>Current Selection:</strong><br>
                Lessons: <strong id="modalSelectedLessonsText">All lessons</strong><br>
                Available words: <strong id="modalAvailableWordsCount">0</strong>
            </div>
            
            <button class="btn" onclick="applyLessonSelection()">Apply Selection</button>
        </div>
    </div>

    <!-- Mastered Words Modal -->
    <div class="modal" id="masteredWordsModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>‚úÖ Mastered Words</h2>
                <button class="modal-close" onclick="closeMasteredWordsModal()">&times;</button>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label for="masteredWordsDirection" style="font-weight: 600; margin-bottom: 5px; display: block;">Filter by Direction:</label>
                <select id="masteredWordsDirection" onchange="refreshMasteredWordsList()" style="width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px;">
                    <option value="all">All Directions</option>
                    <option value="greek_to_bulgarian">Greek ‚Üí Bulgarian</option>
                    <option value="bulgarian_to_greek">Bulgarian ‚Üí Greek</option>
                </select>
            </div>
            
            <div id="masteredWordsStats" style="margin-bottom: 15px; padding: 10px; background: #e8f5e9; border-radius: 5px; font-size: 0.9em;">
                <!-- Stats will be inserted here -->
            </div>
            
            <div id="masteredWordsList" style="max-height: 400px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 5px; padding: 10px;">
                <!-- List will be inserted here -->
            </div>
            
            <button class="btn" onclick="closeMasteredWordsModal()" style="margin-top: 15px;">Close</button>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="/static/js/app.js?v=3"></script>
    <script src="/static/js/greek-keyboard.js"></script>
</body>
</html>
